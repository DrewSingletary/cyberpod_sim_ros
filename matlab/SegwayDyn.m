function [f,g] = SegwayDyn(X,model)
x = X(1);
v = X(2);
psi = X(3);
psiDot = X(4);

mb = model(1);
mw = model(2);
Jw = model(3);
a2 = model(4);
c2 = model(5);
A2 = model(6);
B2 = model(7);
C2 = model(8);
K = model(9);
r = model(10);
L = model(11);
gGravity = model(12);
FricCoeff = model(13);
velEps = model(14);
FricCoeffViscous = model(15);

%%
Fric = FricCoeff*tanh((v-psiDot.*r)./velEps) + FricCoeffViscous*(v-psiDot.*r);

f = [v,(1/2).*r.*((-8).*B2.*Fric+(-8).*a2.^2.*Fric.*mb+(-8).*c2.^2.* ...
  Fric.*mb+mb.*((-8).*c2.*Fric+4.*a2.*B2.*psiDot.^2+4.*a2.^3.*mb.* ...
  psiDot.^2+4.*a2.*c2.^2.*mb.*psiDot.^2).*r.*cos(psi)+(-4).*a2.*c2.* ...
  gGravity.*mb.^2.*r.*cos(2.*psi)+8.*a2.*Fric.*mb.*r.*sin(psi)+4.* ...
  B2.*c2.*mb.*psiDot.^2.*r.*sin(psi)+4.*a2.^2.*c2.*mb.^2.* ...
  psiDot.^2.*r.*sin(psi)+4.*c2.^3.*mb.^2.*psiDot.^2.*r.*sin(psi)+2.* ...
  a2.^2.*gGravity.*mb.^2.*r.*sin(2.*psi)+(-2).*c2.^2.*gGravity.* ...
  mb.^2.*r.*sin(2.*psi)).*(4.*B2.*Jw+4.*a2.^2.*Jw.*mb+4.*c2.^2.*Jw.* ...
  mb+2.*B2.*mb.*r.^2+a2.^2.*mb.^2.*r.^2+c2.^2.*mb.^2.*r.^2+4.*B2.* ...
  mw.*r.^2+4.*a2.^2.*mb.*mw.*r.^2+4.*c2.^2.*mb.*mw.*r.^2+(a2.^2+(-1) ...
  .*c2.^2).*mb.^2.*r.^2.*cos(2.*psi)+2.*a2.*c2.*mb.^2.*r.^2.*sin(2.* ...
  psi)).^(-1),psiDot,(4.*B2.*Jw+4.*a2.^2.*Jw.*mb+4.*c2.^2.*Jw.*mb+ ...
  2.*B2.*mb.*r.^2+a2.^2.*mb.^2.*r.^2+c2.^2.*mb.^2.*r.^2+4.*B2.*mw.* ...
  r.^2+4.*a2.^2.*mb.*mw.*r.^2+4.*c2.^2.*mb.*mw.*r.^2+(a2.^2+(-1).* ...
  c2.^2).*mb.^2.*r.^2.*cos(2.*psi)+2.*a2.*c2.*mb.^2.*r.^2.*sin(2.* ...
  psi)).^(-1).*(8.*Fric.*Jw+4.*Fric.*mb.*r.^2+8.*Fric.*mw.*r.^2+2.* ...
  mb.*(2.*c2.*Fric.*r+a2.*gGravity.*(2.*Jw+(mb+2.*mw).*r.^2)).*cos( ...
  psi)+(-2).*a2.*c2.*mb.^2.*psiDot.^2.*r.^2.*cos(2.*psi)+4.*c2.* ...
  gGravity.*Jw.*mb.*sin(psi)+(-4).*a2.*Fric.*mb.*r.*sin(psi)+2.*c2.* ...
  gGravity.*mb.^2.*r.^2.*sin(psi)+4.*c2.*gGravity.*mb.*mw.*r.^2.* ...
  sin(psi)+a2.^2.*mb.^2.*psiDot.^2.*r.^2.*sin(2.*psi)+(-1).*c2.^2.* ...
  mb.^2.*psiDot.^2.*r.^2.*sin(2.*psi))]';


g = [0,2.*K.*r.*(B2+a2.^2.*mb+c2.^2.*mb+c2.*mb.*r.*cos(psi)+(-1).*a2.* ...
  mb.*r.*sin(psi)).*(2.*B2.*Jw+2.*a2.^2.*Jw.*mb+2.*c2.^2.*Jw.*mb+ ...
  B2.*mb.*r.^2+a2.^2.*mb.^2.*r.^2+c2.^2.*mb.^2.*r.^2+2.*B2.*mw.* ...
  r.^2+2.*a2.^2.*mb.*mw.*r.^2+2.*c2.^2.*mb.*mw.*r.^2+(-1).*c2.^2.* ...
  mb.^2.*r.^2.*cos(psi).^2+(-1).*a2.^2.*mb.^2.*r.^2.*sin(psi).^2+ ...
  a2.*c2.*mb.^2.*r.^2.*sin(2.*psi)).^(-1),0,(-4).*K.*(2.*Jw+mb.* ...
  r.^2+2.*mw.*r.^2+c2.*mb.*r.*cos(psi)+(-1).*a2.*mb.*r.*sin(psi)).*( ...
  4.*B2.*Jw+4.*a2.^2.*Jw.*mb+4.*c2.^2.*Jw.*mb+2.*B2.*mb.*r.^2+ ...
  a2.^2.*mb.^2.*r.^2+c2.^2.*mb.^2.*r.^2+4.*B2.*mw.*r.^2+4.*a2.^2.* ...
  mb.*mw.*r.^2+4.*c2.^2.*mb.*mw.*r.^2+(a2.^2+(-1).*c2.^2).*mb.^2.* ...
  r.^2.*cos(2.*psi)+2.*a2.*c2.*mb.^2.*r.^2.*sin(2.*psi)).^(-1)]';


end

